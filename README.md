# Лабораторная работа №2 по курсу «Функциональное программирование»

Выполнил: Тюрин Иван, группа P34102

Текст задания: [TASK.md](./TASK.md)

Вариант: `bt-bag`

|             | Bag(multiset) |
|-------------|---------------|
| Binary Tree | `bt-bag`      |

## Требования

1. Функции:
    - [x] добавление и удаление элементов;
    - [x] фильтрация;
    - [x] отображение (map);
    - [x] свертки (левая и правая);
    - [x] структура должна быть [моноидом](https://ru.m.wikipedia.org/wiki/Моноид).
2. Структуры данных должны быть
    - [x] неизменяемыми,
    - [x] полиморфными. (это про реализуемую структуру данных?)
3. Библиотека должна быть протестирована в рамках
    - [x] unit testing.
    - [x] property-based тестирования (как минимум 3 свойства, включая свойства моноида).
4. Нефункциональные требования:
    - [x] Должна быть эффективная реализация функции сравнения, реализованная на
    уровне API, а не внутреннего представления.

## Комментарии по ходу выполнения

Основные модули:

- [BinTree.idr](./bt-bag/src/BinTree.idr) — реализация бинарного дерева.
- [Bag.idr](./bt-bag/src/Bag.idr) — реализация бэга (бинарного дерева «бэгов»)

Тесты:

- [BagUnitTests.idr](bt-bag\test\src\BagUnitTests.idr) -- unit-тесты бэга
- [BinTreeUnitTests.idr](bt-bag\test\src\BinTreeUnitTests.idr) -- unit-тесты бинарного дерева
- [PropTests.idr](bt-bag\test\src\PropTests.idr) -- Property-Based-тесты.

В качестве операции полугруппы использовалось объединение деревьев как
множеств. Аналогично происходит сравнение, через равенство упорядоченного
списка со всеми элементами.

Примеры реализаций структур на Idris:
- наивная реализация в книге Type Driven Development в листинге "Listing 4.7 Defining binary trees (Tree.idr)"
- Idris2 Tree с верификацией: https://github.com/polendri/idris-collections/blob/master/src/Collections/BSTree/Set/Core.idr
- https://github.com/jfdm/idris-containers
- https://github.com/buzden/deptycheck/blob/master/examples/sorted-tree-naive/src/Data/SortedBinTree.idr

Пришел к выводу, что ограничения на типы в структуре данных лучше оставлять в
методах для работы с этой структурой данных. Подробнее:
- https://stackoverflow.com/a/19650352/19036461

По ходу работы возникла проблема с LSP — он зависает и нагружает 100% CPU.
- https://github.com/idris-community/idris2-lsp/issues/240

## Тестовое покрытие

Библиотека Hedgehog для Property-Based-тестов.
Она же использовалась и для unit-тестов, где
нет генератора и одна итерация.

## Выводы

Разработан модуль представляющий структуру бинарного дерева
(представляющего множество) и бинарного дерева бэгов
(в сущности мультимножество).

К модулям разработано тестовое покрытие.

